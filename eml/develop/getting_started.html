<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Getting Started - Enshrouded Modding Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../../";
            const default_light_theme = "light";
            const default_dark_theme = "ayu";
            window.path_to_searchindex_js = "../../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Enshrouded Modding Documentation</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="getting-started"><a class="header" href="#getting-started">Getting Started</a></h1>
<p>Before you begin, make sure to setup your development environment as described <a href="./setup.html">here</a>.</p>
<p>This guide only covers the <code>patch</code> and <code>export</code> capabilities. The <code>runtime</code> capability is still a work in progress and cannot be used yet.</p>
<h2 id="hello-world"><a class="header" href="#hello-world">Hello World</a></h2>
<p>Now that you have your environment set up, you should see a <code>mod.lua</code> file in the <code>src</code> directory of your mod.
By default it contains a simple Hello World example like this:</p>
<pre><code class="language-lua">print("Hello from the default mod!")
</code></pre>
<p>To run your mod refer to the <a href="../usage.html">usage guide</a>.
As soon as you run EML either via the CLI or the proxy DLL, you should see the message in the console output.<br />
To see a console window when using the proxy DLL, you need to enable it in the <code>eml.json</code> configuration file as described <a href="../usage.html#emljson-configuration">here</a>.</p>
<h2 id="definition-files"><a class="header" href="#definition-files">Definition Files</a></h2>
<p>As soon as you run EML for the first time, it will generate definition files for the Lua language server to provide autocompletion and type checking,
but they may also be used to just lookup available functions and types (especially for the game data structures).
When either the game or EML is updated, it will regenerate the definition files on the next run to ensure they are up to date.</p>
<p>These files are located in the <code>.cache/lua</code> directory of your game installation and there are currently two sets of definition files:</p>
<ul>
<li><code>base.lua</code>: Contains definitions (including documentation) for the EML API.</li>
<li><code>types.lua</code>: Contains auto generated type definitions for game data structures.</li>
</ul>
<p>If you generated a new mod using the CLI, it will also create a <code>.luarc.json</code> file in your mod directory to configure the Lua language server to use these definition files.
If you want to develop your mod in a different directory, make sure to adjust the paths in the <code>.luarc.json</code> file accordingly or else you won't get any autocompletion or type checking.</p>
<h2 id="eml-api-structure"><a class="header" href="#eml-api-structure">EML API Structure</a></h2>
<p>The EML API is divided into several globally accessable modules.</p>
<p>The most important ones are:</p>
<ul>
<li><code>game</code>: The main module to access and modify game data and assets.</li>
<li><code>loader</code>: Used to access information about the mod loader and loaded mods.
For example, you can check which mods are currently loaded or what capabilities are enabled.</li>
<li><code>buffer</code>: Provides a buffer type to work with binary data.
Since content assets are stored in an abitrary binary format, this module is essential for reading and modifying them.
There are also some modules (more coming soon) that do the parsing for you, like the <code>image</code> module for reading and writing images.</li>
</ul>
<p>Helpful modules when working with game assets:</p>
<ul>
<li><code>image</code>: A module for reading and writing images in various formats.
It provides an image type that can be used to manipulate image data.
You can convert game textures to PNG (or some other format) and vice versa.</li>
<li><code>integer</code>: Provides functions for integers of various sizes.
There are a lot of game data structures that use fixed size integers (e.g., <code>u8</code>, <code>u16</code>, etc.) and this module provides functions to work with them more comfortably.
For example, adding two <code>u8</code> values together while ensuring the result is still a <code>u8</code>.
If you're unfamiliar with these types, see the <a href="#type-aliases">Type Aliases</a> section below.</li>
<li><code>hasher</code>: Provides functions to compute hashes using various algorithms that are used by the game.
This is mainly useful when working with game assets, as they are often identified by their hash values.
There is also the <code>game.guid.hash</code> function which computes the hash of a GUID.</li>
</ul>
<p>Other useful modules include:</p>
<ul>
<li><code>io</code>: Provides functions for file system operations.
This is especially useful when using the <code>export</code> capability to save data to the export directory.
All operations are confined to either the <code>export</code> directory or the mod's own directory to prevent mods from accessing arbitrary files on the user's system.</li>
</ul>
<p>For more detailed information about the available modules and their functions, refer to the <a href="../api/index.html">API Reference</a>.</p>
<h3 id="type-aliases"><a class="header" href="#type-aliases">Type Aliases</a></h3>
<p>If you have already looked at the definition files, you may have noticed that there are a lot of these <code>u8</code>, <code>i32</code>, <code>f32</code>, etc. types.
These are type aliases for fixed size integers and floating point numbers.</p>
<p>You should always make sure that the values match the boundaries of the specified type, or else it will raise an error.
For example, a <code>u8</code> can only hold values from <code>0</code> to <code>255</code>, so trying to assign a value of <code>300</code> to a <code>u8</code> variable will result in an error.</p>
<p>The naming convention for these integer types is as follows:</p>
<ul>
<li><code>u</code>: Unsigned integer followed by the number of bits (e.g., <code>u8</code>, <code>u16</code>, <code>u32</code>, <code>u64</code>).</li>
<li><code>i</code>: Signed integer followed by the number of bits (e.g., <code>i8</code>, <code>i16</code>, <code>i32</code>, <code>i64</code>).</li>
<li><code>f</code>: Floating point number followed by the number of bits (e.g., <code>f16</code>, <code>f32</code>, <code>f64</code>).</li>
</ul>
<h2 id="accessing-game-data"><a class="header" href="#accessing-game-data">Accessing Game Data</a></h2>
<p>To access game data, you will primarily use the <code>game.assets</code> module.
But before we dive into the details, let's first understand how game data is organized.</p>
<h3 id="game-data"><a class="header" href="#game-data">Game Data</a></h3>
<p>There are two distinct types of game data:</p>
<ul>
<li>
<p><strong>Resources</strong>: These are rather small data files that contain typed binary data.
They are referenced by a GUID, a qualified type name and a part index.
The part index of a resource is used to distinguish between multiple resources with the same guid and type that belong together.
The way how part indices are used is specific to the type of resource.
For example, the voxel chunks of a scene are made up of multiple parts where all have the same type and guid, but have different part indices that specify their position.</p>
<p>They are provided as lua table-like userdata objects.
The structure of these objects is defined in the <code>types.lua</code> definition file.</p>
</li>
<li>
<p><strong>Content Assets</strong>: These are blobs that contain arbitrary binary data like images, audio, models, voxels, etc.
They are always referenced by resources via a field with the <code>keen::ContentHash</code> type.
Content assets are not parsed by EML, but instead provided as raw binary data as a <a href="../api/buffer.html"><code>Buffer</code></a> object.
There are also some helper modules like the <code>image</code> module to work with specific content types.</p>
</li>
</ul>
<h3 id="accessing-resources"><a class="header" href="#accessing-resources">Accessing Resources</a></h3>
<p>To access resources, you can use one of the <code>game.assets.get_resource*</code> functions.</p>
<p>If you know the exact guid, type and part index of a resource, you can use the <code>game.assets.get_resource</code> function like this:</p>
<pre><code class="language-lua">local game_scene = game.assets.get_resource("509feadb-4c60-425f-9c7c-deeefd9b6920", "keen::SceneResource", 0)

print("Guid: " .. game_scene.guid)
print("Type: " .. game_scene.type)
print("Part Index: " .. game_scene.part_index)
print("Data: " .. tostring(game_scene.data))
</code></pre>
<p>As you can see, it doesn't return the actual data directly, but instead a <code>Resource</code> object that contains some metadata about the resource (like its guid, type, part index, etc.) and the actual data is stored in the <code>data</code> field of the resource object.</p>
<p><strong>Note:</strong> The <code>Resource</code> object can be assigned everywhere where a <code>Guid</code> or <code>ObjectReference</code> is expected, so you can pass it directly to functions and fields that expect these types without having to extract the guid manually.</p>
<p>But there are also cases where you don't know the exact guid or type of a resource or are just unsure if it changes between game versions.
In these cases, you can use the either <code>game.assets.get_resources_by_type</code> or <code>game.assets.get_all_resources</code> functions to get a list of resources that match certain criteria.</p>
<p>As an example, to get all resources of a certain type, you can use the <code>game.assets.get_resources_by_type</code> function like this:</p>
<pre><code class="language-lua">local items = game.assets.get_resources_by_type("keen::ItemInfo")

for _, item in ipairs(items) do
    local item_data = item.data  -- Access the actual data of the resource

    print(item_data.itemId.value, item_data.debugName)
end
</code></pre>
<p>And if you don't know what types of resources are available, you can use the <code>game.assets.get_resource_types</code> function to get a list of all available resource types.
It is primarily useful for exploration and debugging purposes.</p>
<pre><code class="language-lua">local resource_types = game.assets.get_resource_types()

for _, resource_type in ipairs(resource_types) do
    print(resource_type)
end
</code></pre>
<p>As a last resort, there is also the <code>game.assets.get_all_resources</code> function that returns all resources in the game.
It is not recommended to use this function to filter resources by type or guid, as it is less efficient than using the other functions.</p>
<h3 id="modifying-resources"><a class="header" href="#modifying-resources">Modifying Resources</a></h3>
<p>To modify game data, you can simply change the fields of the resource's <code>data</code> object or the <code>data</code> field itself to overwrite the entire resource.
Since resources are provided as lua table-like userdata objects, you can access and modify their fields just like you would with a regular lua table.
Modifications to resources are checked for validity, so make sure to only assign valid values to fields.
If you try to assign an invalid value, it will raise an error.</p>
<p><strong>Important:</strong> If you assign a reference value (i.e., a table or a userdata) to a field, it will create a deep copy of the value.
So subsequent modifications to the original value will <strong>not</strong> affect the resource's data.</p>
<h2 id="creating-a-simple-patch"><a class="header" href="#creating-a-simple-patch">Creating a Simple Patch</a></h2>
<p>Now that you have a basic understanding of how to set up your environment and run your mod, let's create a simple patch that modifies some game data.
Open the <code>mod.lua</code> file in your mod's <code>src</code> directory and replace the existing code with the following:</p>
<pre><code class="language-lua">---@type keen.BalancingTable
local BalancingTable = game.assets.get_resources_by_type("keen::BalancingTable")[1].data

BalancingTable.playerBaseStamina = 500
</code></pre>
<p>The first line (the <code>---@type</code> annotation) is a type hint that tells the Lua language server what type the <code>BalancingTable</code> variable has.
This is not strictly necessary, but it helps with autocompletion and type checking.</p>
<p>The second line retrieves the first resource of type <code>keen::BalancingTable</code> and accesses its <code>data</code> field to get the actual balancing table data.</p>
<p>And in the last line, we modify the <code>playerBaseStamina</code> field to set the player's base stamina to <code>500</code>.</p>
<h2 id="exporting-data"><a class="header" href="#exporting-data">Exporting Data</a></h2>
<p>To export data from the game, you'll have to use the <code>export</code> capability.
Make sure to enable it in your <code>eml.json</code> configuration file if you're using the proxy DLL.</p>
<p>Now, let's modify our <code>mod.lua</code> file to export the string representation of the balancing table to a file.</p>
<pre><code class="language-lua">---@type keen.BalancingTable
local BalancingTable = game.assets.get_resources_by_type("keen::BalancingTable")[1].data

io.export("balancing_table.txt", tostring(BalancingTable))
</code></pre>
<p>When you run your mod now, it will create a file named <code>balancing_table.txt</code> in the <code>export</code> directory of your game installation (unless you changed it).
If you specify a subdirectory in the file name, it will create the necessary directories automatically.</p>
<p>You can also export a <a href="../api/buffer.html"><code>Buffer</code></a> object directly to export its binary data.</p>
<p><strong>Important:</strong> The <code>export</code> function can only write files to the <code>export</code> directory. Files that already exist will be overwritten without warning!</p>
<h2 id="next-steps"><a class="header" href="#next-steps">Next Steps</a></h2>
<p>Now that you have created a simple patch, you start looking into all the resource types that are available.
But most things have not been documented yet, so you'll need to figure stuff out by yourself what certain things do.
The best way is to just try things out and see what happens.</p>
<p>When it comes to content assets, i highly suggest exporting the binary data with the <code>export</code> capability and inspecting it with external tools such as <a href="https://github.com/WerWolv/ImHex">ImHex</a> for binary analysis.
Be aware that this requires some knowledge about binary formats and reverse engineering, so it may not be suitable for everyone.</p>
<p>Check out the <strong>References</strong> section for stuff that has already been documented.</p>
<p>Everything that has not been covered in this guide yet is documented in the <a href="../api/index.html">API Reference</a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../eml/develop/setup.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../eml/api/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../eml/develop/setup.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../eml/api/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
